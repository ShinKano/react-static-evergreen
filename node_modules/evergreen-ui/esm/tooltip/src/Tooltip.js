import _extends from "@babel/runtime/helpers/esm/extends";
import _objectSpread from "@babel/runtime/helpers/esm/objectSpread";
import _objectWithoutProperties from "@babel/runtime/helpers/esm/objectWithoutProperties";
import _classCallCheck from "@babel/runtime/helpers/esm/classCallCheck";
import _createClass from "@babel/runtime/helpers/esm/createClass";
import _possibleConstructorReturn from "@babel/runtime/helpers/esm/possibleConstructorReturn";
import _getPrototypeOf from "@babel/runtime/helpers/esm/getPrototypeOf";
import _assertThisInitialized from "@babel/runtime/helpers/esm/assertThisInitialized";
import _inherits from "@babel/runtime/helpers/esm/inherits";
import _defineProperty from "@babel/runtime/helpers/esm/defineProperty";
import React, { PureComponent } from 'react';
import PropTypes from 'prop-types';
import debounce from 'lodash.debounce';
import { Positioner } from '../../positioner';
import { Position } from '../../constants';
import TooltipStateless from './TooltipStateless';
var idCounter = 0;

var Tooltip =
/*#__PURE__*/
function (_PureComponent) {
  _inherits(Tooltip, _PureComponent);

  function Tooltip(props, context) {
    var _this;

    _classCallCheck(this, Tooltip);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(Tooltip).call(this, props, context));

    _defineProperty(_assertThisInitialized(_this), "show", function () {
      if (_this.state.isShown) return;

      _this.setState({
        willShow: true
      });

      setTimeout(function () {
        if (!_this.state.willShow) return;

        _this.setState({
          isShown: true
        });
      }, _this.props.showDelay);
    });

    _defineProperty(_assertThisInitialized(_this), "hide", function () {
      _this.setState({
        isShown: false,
        willShow: false
      });
    });

    _defineProperty(_assertThisInitialized(_this), "renderTarget", function (_ref) {
      var getRef = _ref.getRef;
      var children = _this.props.children;
      var tooltipTargetProps = {
        onMouseEnter: _this.show,
        onMouseLeave: _this.hide,
        'aria-describedby': _this.state.id
        /**
         * Tooltips can be used within a Popover (not the other way around)
         * When a Tooltip is used within a Popover, the Popover passes
         * its props to the Tooltip in a `popoverProps` object.
         */
        // eslint-disable-next-line react/prop-types

      };

      if (_this.props.popoverProps) {
        var _this$props$popoverPr = _this.props.popoverProps,
            getTargetRef = _this$props$popoverPr.getTargetRef,
            isShown = _this$props$popoverPr.isShown,
            popoverTargetProps = _objectWithoutProperties(_this$props$popoverPr, ["getTargetRef", "isShown"]);

        return React.cloneElement(children, _objectSpread({}, popoverTargetProps, tooltipTargetProps, {
          innerRef: function innerRef(ref) {
            // Get the ref for the Tooltip.
            getRef(ref); // Pass the ref to the Popover.

            getTargetRef(ref);
          }
        }));
      }
      /**
       * With normal usage only the props for a Tooltip are passed to the target.
       */


      return React.cloneElement(children, _objectSpread({}, tooltipTargetProps, {
        innerRef: function innerRef(ref) {
          getRef(ref);
        }
      }));
    });

    _defineProperty(_assertThisInitialized(_this), "isPopoverShown", function () {
      return (// eslint-disable-next-line react/prop-types
        _this.props.popoverProps && _this.props.popoverProps.isShown
      );
    });

    _defineProperty(_assertThisInitialized(_this), "handleMouseEnterTarget", function () {
      _this.setState({
        isShownByTarget: true
      });
    });

    _defineProperty(_assertThisInitialized(_this), "handleMouseLeaveTarget", function () {
      _this.setState({
        isShownByTarget: false,
        willShow: false
      });
    });

    _this.state = {
      id: "evergreen-tooltip-".concat(++idCounter),
      willShow: false,
      isShown: props.isShown,
      isShownByTarget: false
    };
    _this.handleMouseLeaveTarget = debounce(_this.handleMouseLeaveTarget, _this.props.hideDelay);
    _this.hide = debounce(_this.hide, _this.props.hideDelay);
    return _this;
  }

  _createClass(Tooltip, [{
    key: "render",
    value: function render() {
      var _this2 = this;

      var _this$props = this.props,
          appearance = _this$props.appearance,
          isShown = _this$props.isShown,
          content = _this$props.content,
          position = _this$props.position,
          statelessProps = _this$props.statelessProps;
      var _this$state = this.state,
          stateIsShown = _this$state.isShown,
          isShownByTarget = _this$state.isShownByTarget;
      var shown = (isShown || stateIsShown || isShownByTarget) && !this.isPopoverShown(); // Tooltip was explicitly set to not be shown

      if (isShown === false) {
        shown = false;
      }

      return React.createElement(Positioner, {
        target: function target(_ref2) {
          var getRef = _ref2.getRef;
          return _this2.renderTarget({
            getRef: getRef
          });
        },
        isShown: shown,
        position: position,
        animationDuration: 160
      }, function (_ref3) {
        var css = _ref3.css,
            style = _ref3.style,
            state = _ref3.state,
            getRef = _ref3.getRef;
        return React.createElement(TooltipStateless, _extends({
          id: _this2.state.id,
          appearance: appearance,
          innerRef: function innerRef(ref) {
            return getRef(ref);
          },
          "data-state": state,
          css: css,
          style: style,
          onMouseEnter: _this2.handleMouseEnterTarget,
          onMouseLeave: _this2.handleMouseLeaveTarget
        }, statelessProps), content);
      });
    }
  }]);

  return Tooltip;
}(PureComponent);

Tooltip.displayName = "Tooltip";

_defineProperty(Tooltip, "propTypes", {
  /**
   * The appearance of the tooltip.
   */
  appearance: PropTypes.oneOf(['default', 'card']).isRequired,

  /**
   * The position the Popover is on.
   */
  position: PropTypes.oneOf([Position.TOP, Position.TOP_LEFT, Position.TOP_RIGHT, Position.BOTTOM, Position.BOTTOM_LEFT, Position.BOTTOM_RIGHT, Position.LEFT, Position.RIGHT]),

  /**
   * The content of the Popover.
   */
  content: PropTypes.node.isRequired,

  /**
   * Time in ms before hiding the Tooltip.
   */
  hideDelay: PropTypes.number.isRequired,

  /**
   * Time in ms before showing the Tooltip.
   */
  showDelay: PropTypes.number.isRequired,

  /**
   * When True, manually show the Tooltip.
   */
  isShown: PropTypes.bool,

  /**
   * The target button of the Tooltip.
   */
  children: PropTypes.node.isRequired,

  /**
   * Properties passed through to the Tooltip.
   */
  statelessProps: PropTypes.object
});

_defineProperty(Tooltip, "defaultProps", {
  appearance: 'default',
  position: Position.BOTTOM,
  hideDelay: 120,
  showDelay: 0
});

export { Tooltip as default };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy90b29sdGlwL3NyYy9Ub29sdGlwLmpzIl0sIm5hbWVzIjpbIlJlYWN0IiwiUHVyZUNvbXBvbmVudCIsIlByb3BUeXBlcyIsImRlYm91bmNlIiwiUG9zaXRpb25lciIsIlBvc2l0aW9uIiwiVG9vbHRpcFN0YXRlbGVzcyIsImlkQ291bnRlciIsIlRvb2x0aXAiLCJwcm9wcyIsImNvbnRleHQiLCJzdGF0ZSIsImlzU2hvd24iLCJzZXRTdGF0ZSIsIndpbGxTaG93Iiwic2V0VGltZW91dCIsInNob3dEZWxheSIsImdldFJlZiIsImNoaWxkcmVuIiwidG9vbHRpcFRhcmdldFByb3BzIiwib25Nb3VzZUVudGVyIiwic2hvdyIsIm9uTW91c2VMZWF2ZSIsImhpZGUiLCJpZCIsInBvcG92ZXJQcm9wcyIsImdldFRhcmdldFJlZiIsInBvcG92ZXJUYXJnZXRQcm9wcyIsImNsb25lRWxlbWVudCIsImlubmVyUmVmIiwicmVmIiwiaXNTaG93bkJ5VGFyZ2V0IiwiaGFuZGxlTW91c2VMZWF2ZVRhcmdldCIsImhpZGVEZWxheSIsImFwcGVhcmFuY2UiLCJjb250ZW50IiwicG9zaXRpb24iLCJzdGF0ZWxlc3NQcm9wcyIsInN0YXRlSXNTaG93biIsInNob3duIiwiaXNQb3BvdmVyU2hvd24iLCJyZW5kZXJUYXJnZXQiLCJjc3MiLCJzdHlsZSIsImhhbmRsZU1vdXNlRW50ZXJUYXJnZXQiLCJvbmVPZiIsImlzUmVxdWlyZWQiLCJUT1AiLCJUT1BfTEVGVCIsIlRPUF9SSUdIVCIsIkJPVFRPTSIsIkJPVFRPTV9MRUZUIiwiQk9UVE9NX1JJR0hUIiwiTEVGVCIsIlJJR0hUIiwibm9kZSIsIm51bWJlciIsImJvb2wiLCJvYmplY3QiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxPQUFPQSxLQUFQLElBQWdCQyxhQUFoQixRQUFxQyxPQUFyQztBQUNBLE9BQU9DLFNBQVAsTUFBc0IsWUFBdEI7QUFDQSxPQUFPQyxRQUFQLE1BQXFCLGlCQUFyQjtBQUNB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QUdBbkIsRUFBQUEsT0FBTyxFQUFFakMsU0FBUyxDQUFDcUQsSUFBVixDQUFlVCxVQXZCUDs7QUF5QmpCOzs7QUFHQWIsRUFBQUEsU0FBUyxFQUFFL0IsU0FBUyxDQUFDc0QsTUFBVixDQUFpQlYsVUE1Qlg7O0FBOEJqQjs7O0FBR0E5QixFQUFBQSxTQUFTLEVBQUVkLFNBQVMsQ0FBQ3NELE1BQVYsQ0FBaUJWLFVBakNYOztBQW1DakI7OztBQUdBbEMsRUFBQUEsT0FBTyxFQUFFVixTQUFTLENBQUN1RCxJQXRDRjs7QUF3Q2pCOzs7QUFHQXZDLEVBQUFBLFFBQVEsRUFBRWhCLFNBQVMsQ0FBQ3FELElBQVYsQ0FBZVQsVUEzQ1I7O0FBNkNqQjs7O0FBR0FULEVBQUFBLGNBQWMsRUFBRW5DLFNBQVMsQ0FBQ3dEO0FBaERULEM7O2dCQURBbEQsTyxrQkFvREc7QUFDcEIwQixFQUFBQSxVQUFVLEVBQUUsU0FEUTtBQUVwQkUsRUFBQUEsUUFBUSxFQUFFL0IsUUFBUSxDQUFDNkMsTUFGQztBQUdwQmpCLEVBQUFBLFNBQVMsRUFBRSxHQUhTO0FBSXBCakIsRUFBQUEsU0FBUyxFQUFFO0FBSlMsQzs7U0FwREhSLE8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgUHVyZUNvbXBvbmVudCB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJ1xuaW1wb3J0IGRlYm91bmNlIGZyb20gJ2xvZGFzaC5kZWJvdW5jZSdcbmltcG9ydCB7IFBvc2l0aW9uZXIgfSBmcm9tICcuLi8uLi9wb3NpdGlvbmVyJ1xuaW1wb3J0IHsgUG9zaXRpb24gfSBmcm9tICcuLi8uLi9jb25zdGFudHMnXG5pbXBvcnQgVG9vbHRpcFN0YXRlbGVzcyBmcm9tICcuL1Rvb2x0aXBTdGF0ZWxlc3MnXG5cbmxldCBpZENvdW50ZXIgPSAwXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRvb2x0aXAgZXh0ZW5kcyBQdXJlQ29tcG9uZW50IHtcbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICAvKipcbiAgICAgKiBUaGUgYXBwZWFyYW5jZSBvZiB0aGUgdG9vbHRpcC5cbiAgICAgKi9cbiAgICBhcHBlYXJhbmNlOiBQcm9wVHlwZXMub25lT2YoWydkZWZhdWx0JywgJ2NhcmQnXSkuaXNSZXF1aXJlZCxcblxuICAgIC8qKlxuICAgICAqIFRoZSBwb3NpdGlvbiB0aGUgUG9wb3ZlciBpcyBvbi5cbiAgICAgKi9cbiAgICBwb3NpdGlvbjogUHJvcFR5cGVzLm9uZU9mKFtcbiAgICAgIFBvc2l0aW9uLlRPUCxcbiAgICAgIFBvc2l0aW9uLlRPUF9MRUZULFxuICAgICAgUG9zaXRpb24uVE9QX1JJR0hULFxuICAgICAgUG9zaXRpb24uQk9UVE9NLFxuICAgICAgUG9zaXRpb24uQk9UVE9NX0xFRlQsXG4gICAgICBQb3NpdGlvbi5CT1RUT01fUklHSFQsXG4gICAgICBQb3NpdGlvbi5MRUZULFxuICAgICAgUG9zaXRpb24uUklHSFRcbiAgICBdKSxcblxuICAgIC8qKlxuICAgICAqIFRoZSBjb250ZW50IG9mIHRoZSBQb3BvdmVyLlxuICAgICAqL1xuICAgIGNvbnRlbnQ6IFByb3BUeXBlcy5ub2RlLmlzUmVxdWlyZWQsXG5cbiAgICAvKipcbiAgICAgKiBUaW1lIGluIG1zIGJlZm9yZSBoaWRpbmcgdGhlIFRvb2x0aXAuXG4gICAgICovXG4gICAgaGlkZURlbGF5OiBQcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsXG5cbiAgICAvKipcbiAgICAgKiBUaW1lIGluIG1zIGJlZm9yZSBzaG93aW5nIHRoZSBUb29sdGlwLlxuICAgICAqL1xuICAgIHNob3dEZWxheTogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLFxuXG4gICAgLyoqXG4gICAgICogV2hlbiBUcnVlLCBtYW51YWxseSBzaG93IHRoZSBUb29sdGlwLlxuICAgICAqL1xuICAgIGlzU2hvd246IFByb3BUeXBlcy5ib29sLFxuXG4gICAgLyoqXG4gICAgICogVGhlIHRhcmdldCBidXR0b24gb2YgdGhlIFRvb2x0aXAuXG4gICAgICovXG4gICAgY2hpbGRyZW46IFByb3BUeXBlcy5ub2RlLmlzUmVxdWlyZWQsXG5cbiAgICAvKipcbiAgICAgKiBQcm9wZXJ0aWVzIHBhc3NlZCB0aHJvdWdoIHRvIHRoZSBUb29sdGlwLlxuICAgICAqL1xuICAgIHN0YXRlbGVzc1Byb3BzOiBQcm9wVHlwZXMub2JqZWN0XG4gIH1cblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIGFwcGVhcmFuY2U6ICdkZWZhdWx0JyxcbiAgICBwb3NpdGlvbjogUG9zaXRpb24uQk9UVE9NLFxuICAgIGhpZGVEZWxheTogMTIwLFxuICAgIHNob3dEZWxheTogMFxuICB9XG5cbiAgY29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcbiAgICBzdXBlcihwcm9wcywgY29udGV4dClcblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBpZDogYGV2ZXJncmVlbi10b29sdGlwLSR7KytpZENvdW50ZXJ9YCxcbiAgICAgIHdpbGxTaG93OiBmYWxzZSxcbiAgICAgIGlzU2hvd246IHByb3BzLmlzU2hvd24sXG4gICAgICBpc1Nob3duQnlUYXJnZXQ6IGZhbHNlXG4gICAgfVxuXG4gICAgdGhpcy5oYW5kbGVNb3VzZUxlYXZlVGFyZ2V0ID0gZGVib3VuY2UoXG4gICAgICB0aGlzLmhhbmRsZU1vdXNlTGVhdmVUYXJnZXQsXG4gICAgICB0aGlzLnByb3BzLmhpZGVEZWxheVxuICAgIClcblxuICAgIHRoaXMuaGlkZSA9IGRlYm91bmNlKHRoaXMuaGlkZSwgdGhpcy5wcm9wcy5oaWRlRGVsYXkpXG4gIH1cblxuICBzaG93ID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLnN0YXRlLmlzU2hvd24pIHJldHVyblxuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgd2lsbFNob3c6IHRydWVcbiAgICB9KVxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgaWYgKCF0aGlzLnN0YXRlLndpbGxTaG93KSByZXR1cm5cbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBpc1Nob3duOiB0cnVlXG4gICAgICB9KVxuICAgIH0sIHRoaXMucHJvcHMuc2hvd0RlbGF5KVxuICB9XG5cbiAgaGlkZSA9ICgpID0+IHtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGlzU2hvd246IGZhbHNlLFxuICAgICAgd2lsbFNob3c6IGZhbHNlXG4gICAgfSlcbiAgfVxuXG4gIHJlbmRlclRhcmdldCA9ICh7IGdldFJlZiB9KSA9PiB7XG4gICAgY29uc3QgeyBjaGlsZHJlbiB9ID0gdGhpcy5wcm9wc1xuXG4gICAgY29uc3QgdG9vbHRpcFRhcmdldFByb3BzID0ge1xuICAgICAgb25Nb3VzZUVudGVyOiB0aGlzLnNob3csXG4gICAgICBvbk1vdXNlTGVhdmU6IHRoaXMuaGlkZSxcbiAgICAgICdhcmlhLWRlc2NyaWJlZGJ5JzogdGhpcy5zdGF0ZS5pZFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRvb2x0aXBzIGNhbiBiZSB1c2VkIHdpdGhpbiBhIFBvcG92ZXIgKG5vdCB0aGUgb3RoZXIgd2F5IGFyb3VuZClcbiAgICAgKiBXaGVuIGEgVG9vbHRpcCBpcyB1c2VkIHdpdGhpbiBhIFBvcG92ZXIsIHRoZSBQb3BvdmVyIHBhc3Nlc1xuICAgICAqIGl0cyBwcm9wcyB0byB0aGUgVG9vbHRpcCBpbiBhIGBwb3BvdmVyUHJvcHNgIG9iamVjdC5cbiAgICAgKi9cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QvcHJvcC10eXBlc1xuICAgIGlmICh0aGlzLnByb3BzLnBvcG92ZXJQcm9wcykge1xuICAgICAgY29uc3Qge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QvcHJvcC10eXBlc1xuICAgICAgICBnZXRUYXJnZXRSZWYsXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9wcm9wLXR5cGVzXG4gICAgICAgIGlzU2hvd24sXG4gICAgICAgIC4uLnBvcG92ZXJUYXJnZXRQcm9wc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QvcHJvcC10eXBlc1xuICAgICAgfSA9IHRoaXMucHJvcHMucG9wb3ZlclByb3BzXG5cbiAgICAgIHJldHVybiBSZWFjdC5jbG9uZUVsZW1lbnQoY2hpbGRyZW4sIHtcbiAgICAgICAgLy8gQWRkIHRoZSBQb3BvdmVyIHByb3BzIHRvIHRoZSB0YXJnZXQuXG4gICAgICAgIC4uLnBvcG92ZXJUYXJnZXRQcm9wcyxcbiAgICAgICAgLy8gQWRkIHRoZSBUb29sdGlwIHByb3BzIHRvIHRoZSB0YXJnZXQuXG4gICAgICAgIC4uLnRvb2x0aXBUYXJnZXRQcm9wcyxcblxuICAgICAgICBpbm5lclJlZjogcmVmID0+IHtcbiAgICAgICAgICAvLyBHZXQgdGhlIHJlZiBmb3IgdGhlIFRvb2x0aXAuXG4gICAgICAgICAgZ2V0UmVmKHJlZilcbiAgICAgICAgICAvLyBQYXNzIHRoZSByZWYgdG8gdGhlIFBvcG92ZXIuXG4gICAgICAgICAgZ2V0VGFyZ2V0UmVmKHJlZilcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBXaXRoIG5vcm1hbCB1c2FnZSBvbmx5IHRoZSBwcm9wcyBmb3IgYSBUb29sdGlwIGFyZSBwYXNzZWQgdG8gdGhlIHRhcmdldC5cbiAgICAgKi9cbiAgICByZXR1cm4gUmVhY3QuY2xvbmVFbGVtZW50KGNoaWxkcmVuLCB7XG4gICAgICAuLi50b29sdGlwVGFyZ2V0UHJvcHMsXG4gICAgICBpbm5lclJlZjogcmVmID0+IHtcbiAgICAgICAgZ2V0UmVmKHJlZilcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgaXNQb3BvdmVyU2hvd24gPSAoKSA9PlxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9wcm9wLXR5cGVzXG4gICAgdGhpcy5wcm9wcy5wb3BvdmVyUHJvcHMgJiYgdGhpcy5wcm9wcy5wb3BvdmVyUHJvcHMuaXNTaG93blxuXG4gIGhhbmRsZU1vdXNlRW50ZXJUYXJnZXQgPSAoKSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpc1Nob3duQnlUYXJnZXQ6IHRydWVcbiAgICB9KVxuICB9XG5cbiAgaGFuZGxlTW91c2VMZWF2ZVRhcmdldCA9ICgpID0+IHtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGlzU2hvd25CeVRhcmdldDogZmFsc2UsXG4gICAgICB3aWxsU2hvdzogZmFsc2VcbiAgICB9KVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIGFwcGVhcmFuY2UsXG4gICAgICBpc1Nob3duLFxuICAgICAgY29udGVudCxcbiAgICAgIHBvc2l0aW9uLFxuICAgICAgc3RhdGVsZXNzUHJvcHNcbiAgICB9ID0gdGhpcy5wcm9wc1xuICAgIGNvbnN0IHsgaXNTaG93bjogc3RhdGVJc1Nob3duLCBpc1Nob3duQnlUYXJnZXQgfSA9IHRoaXMuc3RhdGVcblxuICAgIGxldCBzaG93biA9XG4gICAgICAoaXNTaG93biB8fCBzdGF0ZUlzU2hvd24gfHwgaXNTaG93bkJ5VGFyZ2V0KSAmJiAhdGhpcy5pc1BvcG92ZXJTaG93bigpXG5cbiAgICAvLyBUb29sdGlwIHdhcyBleHBsaWNpdGx5IHNldCB0byBub3QgYmUgc2hvd25cbiAgICBpZiAoaXNTaG93biA9PT0gZmFsc2UpIHtcbiAgICAgIHNob3duID0gZmFsc2VcbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFBvc2l0aW9uZXJcbiAgICAgICAgdGFyZ2V0PXsoeyBnZXRSZWYgfSkgPT4ge1xuICAgICAgICAgIHJldHVybiB0aGlzLnJlbmRlclRhcmdldCh7IGdldFJlZiB9KVxuICAgICAgICB9fVxuICAgICAgICBpc1Nob3duPXtzaG93bn1cbiAgICAgICAgcG9zaXRpb249e3Bvc2l0aW9ufVxuICAgICAgICBhbmltYXRpb25EdXJhdGlvbj17MTYwfVxuICAgICAgPlxuICAgICAgICB7KHsgY3NzLCBzdHlsZSwgc3RhdGUsIGdldFJlZiB9KSA9PiAoXG4gICAgICAgICAgPFRvb2x0aXBTdGF0ZWxlc3NcbiAgICAgICAgICAgIGlkPXt0aGlzLnN0YXRlLmlkfVxuICAgICAgICAgICAgYXBwZWFyYW5jZT17YXBwZWFyYW5jZX1cbiAgICAgICAgICAgIGlubmVyUmVmPXtyZWYgPT4gZ2V0UmVmKHJlZil9XG4gICAgICAgICAgICBkYXRhLXN0YXRlPXtzdGF0ZX1cbiAgICAgICAgICAgIGNzcz17Y3NzfVxuICAgICAgICAgICAgc3R5bGU9e3N0eWxlfVxuICAgICAgICAgICAgb25Nb3VzZUVudGVyPXt0aGlzLmhhbmRsZU1vdXNlRW50ZXJUYXJnZXR9XG4gICAgICAgICAgICBvbk1vdXNlTGVhdmU9e3RoaXMuaGFuZGxlTW91c2VMZWF2ZVRhcmdldH1cbiAgICAgICAgICAgIHsuLi5zdGF0ZWxlc3NQcm9wc31cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7Y29udGVudH1cbiAgICAgICAgICA8L1Rvb2x0aXBTdGF0ZWxlc3M+XG4gICAgICAgICl9XG4gICAgICA8L1Bvc2l0aW9uZXI+XG4gICAgKVxuICB9XG59XG4iXX0=